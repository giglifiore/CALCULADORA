const SHAKE_THRESHOLD = 22;

window.addEventListener("devicemotion", e => {
  if (!chatRef || chat.style.display === "none") return;

  const a = e.accelerationIncludingGravity;
  if (!a) return;

  if (lx === undefined) {
    lx = a.x; ly = a.y; lz = a.z;
    return;
  }

  const delta =
    Math.abs(a.x - lx) +
    Math.abs(a.y - ly) +
    Math.abs(a.z - lz);

  if (delta > SHAKE_THRESHOLD) activarPanico();

  lx = a.x; ly = a.y; lz = a.z;
});

/* =========================
   FUNCIÓN PÁNICO
========================= */
function activarPanico() {
  //if (chatRef) chatRef.remove(); // borra para ambos
  //messages.innerHTML = "";
  msg.value = "";
  chat.style.display = "none";
  calc.style.display = "block";
}

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/sw.js");
}

  
</script>

</body>
</html>
